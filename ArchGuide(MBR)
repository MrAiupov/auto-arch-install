Подробная инструкция по установка Arch Linux (на диск с MBR разметкой)

Скачайте установочный образ ArchLinux
и запишите на USB накопитель
https://www.archlinux.org/download/

Загружаемся в установочную среду в виде командной строки, 
мы сразу имеем root доступ, никаких sudo писать не нужно 
во время установки, никогда. Все приведённые ниже команды 
начинаются со знака доллара, его писать тоже не нужно, 
это обозначение начала команды (из за того что некоторые команды длинные, 
и могут просто не поместиться на экран)

Первичная настройка шрифтов, клавиатуры, времени
$ loadkeys ru
$ setfont cyr-sun16
$ timedatectl set-ntp true

Самым первым делом, мы смотри наши диски, через команду
$ lsblk

если у вас уже разделы все имеются, то просто запоминаем 
в каких что будет, у нас будет примерно так 

sda1 - загрузчик windows
sda7 - root (будем форматировать)
sda6 - home (будем форматировать)
sda5 - swap (будем форматировать)
sdb1 - data
sdb2 - system

Но перед этим нам надо пометить наш будущий гипотетический раздел root, 
загрузочной меткой. Для этого откроем программу cfdisk с выбором нашего 
диска sda, вот такой командой
$ cfdisk /dev/sda
(далее выберем стрелками вверх и вниз наш будущий root раздел, 
напомню что это sda7 и просто нажмём на клавиатуре на английском 
"клавишу B", и около данного раздела должна появится звёздочка в столбце Boot)

далее в самом внизу, выбираем пункт "Запись", нажимаем Enter, и вводим слово "yes"
после этого идём в пункт "Выйти" и нажимем Enter
ничего больше там не меняйте, если не знаете что делаете

ВСЁ, мы готовы к форматированию и монтированию наших разделов, 
напоминаю, что данное руководство именно к установке ArchLinux рядом с Windows 10. 
(ОБЯЗАТЕЛЬНО ВСЕ ИМЕНА ДИСКОВ И РАЗДЕЛОВ ПИШЕМ С МАЛЕНЬКОЙ БУКВЫ.)

Форматируем root раздел в ext4 формат и сразу монтируем
$ mkfs.ext4 /dev/sda7
$ mount /dev/sda7 /mnt

Форматируем home раздел в ext4 формат и сразу монтируем
$ mkfs.ext4 /dev/sda6
$ mount /dev/sda6 /mnt/home

Форматируем раздел swap и монтируем
$ mkswap /dev/sda5
$ swapon /dev/sda5

Создаём общий boot раздел, и монтируем туда загрузчик windows
$ mkdir /mnt/boot
$ mount /dev/sda1 /mnt/boot

Создаём дополнительные разделы data и system (по желанию) и монтируем
$ mkdir /mnt/data
$ mkdir /mnt/system
$ mount /dev/sdb1 /mnt/data
$ mount /dev/sdb2 /mnt/system

Выбор зеркал для загрузки. Ставим зеркала для России. 
Это самое сложно, потом всё легко.
(просьба обратить внимание, что лишь в первой строчке одна стрелка вправо, 
(это создание нового файла, с данной строчкой), во всех других две стрелки, 
это добавление новых строк уже в наш существующий файл), 
чтобы не набирать все данные команды заново, просто введите первую, 
а потом дублируйте, изменяя начало ссылки, последняя ссылка немного другая по структуре, 
не ошибитесь. Если ввести неправильно, то не получится установить ArchLinux.

$ echo "Server = http://mirror.yandex.ru/archlinux/\$repo/os/\$arch" > /etc/pacman.d/mirrorlist
$ echo "Server = https://mirror.yandex.ru/archlinux/\$repo/os/\$arch" >> /etc/pacman.d/mirrorlist
$ echo "Server = http://mirror.truenetwork.ru/archlinux/\$repo/os/\$arch" >> /etc/pacman.d/mirrorlist
$ echo "Server = http://mirror.rol.ru/archlinux/\$repo/os/\$arch" >> /etc/pacman.d/mirrorlist
$ echo "Server = https://mirror.rol.ru/archlinux/\$repo/os/\$arch" >> /etc/pacman.d/mirrorlist
$ echo "Server = http://archlinux.zepto.cloud/\$repo/os/\$arch" >> /etc/pacman.d/mirrorlist

Установка основных пакетов
$ pacstrap /mnt base base-devel linux linux-firmware nano dhcpcd netctl

Настройка системы
$ genfstab -pU /mnt >> /mnt/etc/fstab
$ arch-chroot /mnt

И вот мы попадаем в наш ArchLinux, но он ещё до конца не установлен, и нет загрузчика

Прописываем имя компьютера
$ echo "имя_компьютера" > /etc/hostname

Добавляем пользователя'
$ useradd -m -g users -G wheel -s /bin/bash имя_пользователя

Создаем root пароль
$ passwd

Устанавливаем пароль пользователя
$ passwd имя_пользователя

Прописываем часовой пояс
(если не знаешь как правильно пишется твой таймзона, допиши всю команду 
до слова zoneinfo и нажми кнопку Tab и выйдет подсказка, и смотря на подсказку, 
допиши всю команду целиком, у меня например Екатеринбург)
$ ln -svf /usr/share/zoneinfo/Asia/Yekaterinburg /etc/localtime

Добавляем русскую локаль системы
$ echo "en_US.UTF-8 UTF-8" > /etc/locale.gen
$ echo "ru_RU.UTF-8 UTF-8" >> /etc/locale.gen 

Обновим текущую локаль системы'
$ locale-gen

Указываем язык системы
(просьба обратить внимание на кавычки, тут присутствуют ещё и одинарные, 
чаще всего она в английской раскладке, на той же клавише где и обычные кавычки)
$ echo 'LANG="ru_RU.UTF-8"' > /etc/locale.conf

Вписываем шрифт системы и раскладку (стандартный шрифт ужасен, 
поэтому ставим данный шрифт который приятный глазу)
$ echo 'KEYMAP=ru' >> /etc/vconsole.conf
$ echo 'FONT=cyr-sun16' >> /etc/vconsole.conf

Создадим загрузочный RAM диск
$ mkinitcpio -p linux

Устанавливаем загрузчик (обязательно)
$ pacman -Syy
$ pacman -S grub --noconfirm 
$ grub-install /dev/sda
(именно sda, полностью весь диск, на котором у нас система, а не какой то один раздел, 
именно так и ставят на MBR, а вот с GPT будет по другому, там уже нужно создавать 
отдельный раздел для загрузчика, но это к нам не относится)

Обновляем grub.cfg
$ grub-mkconfig -o /boot/grub/grub.cfg

Ставим программу для Wi-fi
$ pacman -S dialog wpa_supplicant --noconfirm 

Устанавливаем SUDO (обращаем внимание на кавычки)
$ echo '%wheel ALL=(ALL) ALL' >> /etc/sudoers

Раскомментируем репозиторий multilib для работы 32-битных приложений в 64-битной системе, 
в нашем случае мы просто добавим строки (обращаем внимание на кавычки и квадратные скобки)
$ echo '[multilib]' >> /etc/pacman.conf
$ echo 'Include = /etc/pacman.d/mirrorlist' >> /etc/pacman.conf
$ pacman -Syy

Ставим иксы и драйвера
$ pacman -S xorg-server xorg-drivers xorg-xinit

Если мы на виртуальной машине, то дополнительно нужно установить ещё и это. 
Но если ставим на реальное железо, то это не нужно по идее.
$ pacman -S virtualbox-guest-utils

Cтавим SDDM (но можно и любой другой, но этот очень дружит с KDE Plasma)
$ pacman -S sddm sddm-kcm --noconfirm

Ставим шрифты, которые сто процентов понадобятся (там значки и иероглифы, 
которые могут не отображаться если не установлены)
$ pacman -S ttf-liberation ttf-dejavu wqy-zenhei --noconfirm 

Ставим сеть
$ pacman -S networkmanager network-manager-applet ppp --noconfirm

Поддержка разделов с ntfc форматированием
$ pacman -S ntfs-3g ufw --noconfirm

Драйвера видеодрайверов Nvidea (если кому надо)
$ pacman -S nvidia vulkan-tools vulkan-icd-loader 
lib32-nvidia-utils lib32-vulkan-icd-loader --noconfirm

Установка аудиодрайверов (обязательно)
$ pacman -S alsa-lib alsa-utils lib32-alsa-plugins lib32-curl --noconfirm

Установить супер минимальный набор рабочего стола Plasma, регулятор громкости, и консоль
$ sudo pacman -S plasma-desktop plasma-pa konsole

Установка программ, которые обязательно нужны
$ pacman -S dolphin ark spectacle kcalc okular gnome-disk-utility gparted 
gwenview kde-gtk-config user-manager screenfetch chromium --noconfirm

Установка Wine (по желанию)
$ pacman -S wine wine-gecko wine-mono multilib-devel --noconfirm

Установка Steam и Litris (по желанию)
$ pacman -S steam lib32-alsa-plugins lib32-curl lutris --noconfirm

Ставим дополнительные программ (по желанию)
$ pacman -S firefox firefox-i18n-ru opera vlc gimp krita kdenlive 
powerdevil libreoffice libreoffice-fresh-ru obs-studio audacity 
qbittorrent inkscape handbrake --noconfirm

Подключаем автозагрузку менеджера входа и интернет
$ systemctl enable sddm
$ systemctl enable NetworkManager

можно перезагружаться
$ reboot

(при первом запуске, grub может не увидеть Windows, 
не стоит пугаться, мы его обновим список чуть позже, если он случайно пропал)

Также не стоит пугаться отвратительного менеджера входа, 
мы изменим его внешний вид на красивый.

Также иногда Plasma, при первом запуске, запускает абсолютно пустой экран,
так как установщик минимальный, то просто клацаем правой кнопной на рабочий стол,
и нажимаем добавить Панель, Стандартная панель.

Что обязательно нужно сделать при первом запуске, 
это открыть консоль, обращаем внимаение что теперь root прав 
по дефолту уже нет, и иногда нужно писать sudo перед командой

и запоминаем нашу первую команду, которая нужна будет практически каждый день
Обновление системы
$ sudo pacman -Suy

Это делать часто не нужно, но можно раз в месяц чистить кэш от старого кэша
$ sudo pacman -Sсс

Все существующие пакеты для установки можно искать по адресу
https://www.archlinux.org/packages/
и сразу читать их описание

либо можно воспользоваться командой (с маленькой английской s)
$ sudo pacman -s имя_пакета

Любой пакет устанавливает очень просто, через консоль, 
просьба не использовать никогда никакие графические установщики. 
Просто вводит команду
$ sudo pacman -S имя_пакета

Сразу надо запомнить, как правильно удалить программу, 
чтобы она сразу забрала с собой все свои зависимости, 
которые использовала, но другим программам они не нужны
$ sudo pacman -Rs имя_пакета

Установка пакета из файла
$ sudo pacman -U /путь_к_файлу/файл.tar.xz

или из сети
$ sudo pacman -U http://www.example.com/repo/example.pkg.tar.xz

Установка virtualbox (по желанию)
$ sudo pacman -S virtualbox virtualbox-host-modules-arch
(если будет спрашивать, какой пакет ставить, выбрать virtualbox-host-modules-arch)
и включаем ядро виртуалки (без этого она не заработает)
$ sudo /usr/bin/rcvboxdrv

ЭТО НЕ ОБЯЗАТЕЛЬНО, НО МОЖНО ВКЛЮЧИТЬ УСТАНОВКУ ПРОГРАММ ИЗ AUR 
(это сборки программ от сообщества Арча, гарантий безопасности очень слабые, 
использовать лишь для установки программ от очень проверенных источников, 
например snap или flatpak). Открываем консоль и сразу пишем
$ sudo pacman -Syu
$ mkdir -p /tmp/yay_install
$ cd /tmp/yay_install
$ sudo pacman -S git
$ git clone https://aur.archlinux.org/yay.git
$ cd yay
$ makepkg -sir --needed --noconfirm --skippgpcheck
$ cd ..
$ cd ..
$ rm -rf yay_install
$ cd ..
$ reboot

Пакеты AUR можно искать здесь
https://aur.archlinux.org/

устанавливать их легко после этого
(обращаем внимание, что тут не надо вводить sudo)
$ yay -S имя_пакета

обновление пакетов AUR (сразу обновит пакеты Арча из пакмана, AUR из AUR)
удобная команда двойного назначения
$ yay -Suy

Вернёмся к GRUB (если в нём не виден windows), 
для автоматического обнаружения ОС отличных от Linux установите пакет os-prober. 
Если после установки пакета os-prober автоматическое обнаружение не работает 
должным образом, то может потребоваться установка пакета hwinfo.
$ sudo pacman -S os-prober
$ sudo os-prober

Обычно этого хватает, что обнаружить все установленные операционные системы.

После этого также советую установить настройщик GRUB
$ sudo pacman -S grub-customizer

запускаем его через меню Пуск, он так и называется Grub Customizer 
и видим после этого меню, которое можно редактировать. 
Редактировать на свой страх и риск.
(я всё удалил, кроме дву пунктов Arch и Windows 10)

Какие настройки нужно сделать после всех манипуляций. 
Нажимаем правой кнопкой на Пуск, и выбираем Взаимозаменяемые виджеты.
Выбираем классическое меню.

Нажимаем правой кнопкой на самой панели Пуск, на пустом месте, и выбираем Взаимозаменяемые виджеты.
Выбираем Панель задач (только значки).

Удаляем все виджеты слева, которые рядом с кнопкой Пуск.
И закрепляем туда лишь свои значки программ.
Надо просто запустить программу, и нажать правой кнопкой, Закрепить.

Не забываем перезагрузиться после этого, есть старый баг, где остаётся линия.

После этого нажимаем кнопку Пуск, Настройки системы.
И ОБЯЗАТЕЛЬНО по порядко идём по всем пунктам.
Из тех что я рекомендую менять.
-- Оформление среды Breeze темный вариант (Применить)
-- Оформление стола Breeze темный вариант (Применить)
-- Оформление приложение, нажимаем пункт справа внизу Настройки оформлений Gnome/GTK, потом опять внизу справа, Загрузить новые оформления, и там ищем Breeze-Darker, загружаем, и выставляем их, в строках Стиль программ для GTK2 и для GTK3
-- Поведение рабочей среды, выставляем двойной клик (Применить)
-- Блокировка экрана, я вырубил, но можно выставить своё время
-- Запуск и завершение, и в первом же пункте, выбираем для менеджера входа SDDM оформление Breeze и нажимаем Применить
-- Локализация (выставляем русский в самый вверх списка)
-- Дата и время (проверяем правильность)
-- Устройство ввода (выставляем раскладку и клавиши)
-- Экран, можно включить ночную цветовую схему
-- Управление питанием (выставляем своё время)

Если сбивается время, при переходе из виндовс в линукс, или наоборот.
то просто вбей в консоли команду, чтобы по дефолту было аппаратное время везде.
(уже и не помню, нужно sudo или нет, вроде нужно)
$ sudo timedatectl set-local-rtc 1
$ sudo timedatectl

Вроде это все рекомендации, которые я вспомнил.
По возможности добавлю ещё.
